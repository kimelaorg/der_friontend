<div class="container mt-4">
  <h2>Product List</h2>

  <table class="table table-striped table-hover table-bordered">
    <thead class="table-dark">
      <tr>
        <th scope="col">Id</th>
        <th scope="col">Product Name</th>
        <th scope="col">Product Description</th>
        <th scope="col">Product Discounted Price</th>
        <th scope="col">Product Actual Price</th>
        <th scope="col">Images</th>
        <th scope="col" colspan="2">Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let product of products">
        <td>{{ product.id }}</td>
        <td>{{ product.productName }}</td>
        <td>{{ product.productDescription }}</td>
        <td>
          <span class="fw-bold text-success">${{ product.productDiscountedPrice | number: '1.2-2' }}</span>
        </td>
        <td>
          <span class="text-muted text-decoration-line-through">${{ product.productActualPrice | number: '1.2-2' }}</span>
        </td>
        <td class="text-center">
          <button class="btn btn-sm btn-outline-info" (click)="openImageModal(product, imageContent)" title="View/Manage Images">
            <i class="bi bi-image"></i> üñºÔ∏è ({{ product.images.length }})
          </button>
        </td>
        <td>
          <!-- <button class="btn btn-sm btn-primary" (click)="editProduct(product)" title="Edit">
            <i class="bi bi-pencil-square"></i> ‚úèÔ∏è
          </button> -->
        </td>
        <td>
          <!-- <button class="btn btn-sm btn-danger" (click)="deleteProduct(product)" title="Delete">
            <i class="bi bi-trash"></i> üóëÔ∏è
          </button> -->
        </td>
      </tr>
    </tbody>
  </table>

  <p class="mt-3 text-info">Modal closed result: {{ closeResult }}</p>

</div>

<ng-template #imageContent let-modal>

  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title" *ngIf="selectedProduct">
      Images for: {{ selectedProduct.productName }} (ID: {{ selectedProduct.id }})
    </h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>

  <div class="modal-body" *ngIf="selectedProduct">

    <div *ngIf="selectedProduct.images.length > 0" class="mb-4">
      <h4>Existing Images ({{ selectedProduct.images.length }})</h4>
      <div class="image-grid">
        <div *ngFor="let imageUrl of selectedProduct.images" class="image-container">
          <img [src]="imageUrl" alt="Product Image" class="img-thumbnail">
          <button class="btn btn-sm btn-danger delete-image-btn" (click)="deleteProductImage(imageUrl)">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="card p-3"
          (dragover)="onDragOver($event)"
          (drop)="onDrop($event)"
          [class.no-images-placeholder]="selectedProduct.images.length === 0"
          [class.drag-over]="false" >

      <h4 class="text-center" *ngIf="selectedProduct.images.length === 0">
        No images found for this product.
      </h4>

      <p class="text-center text-muted">Drag & Drop images here or click to select.</p>

      <input
        type="file"
        id="fileUpload"
        multiple
        (change)="onFileSelect($event)"
        style="display: none;">

      <div class="d-grid gap-2 col-6 mx-auto">
        <button
          type="button"
          class="btn btn-outline-primary"
          onclick="document.getElementById('fileUpload').click()">
          <i class="bi bi-upload"></i> Select and Upload Images
        </button>
      </div>
    </div>

    <div *ngIf="filesToUpload.length > 0" class="mt-3">
      <h6>Files Staged ({{ filesToUpload.length }})</h6>
      <ul class="list-group">
        <li *ngFor="let file of filesToUpload" class="list-group-item d-flex justify-content-between align-items-center">
          {{ file.name }}
          <span class="badge bg-secondary rounded-pill">{{ file.size / 1024 | number: '1.0-2' }} KB</span>
        </li>
      </ul>
    </div>

  </div>

  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.close('Cancel click')">Cancel</button>

    <button
      type="button"
      class="btn btn-success"
      [disabled]="filesToUpload.length === 0"
      (click)="uploadStagedFiles()">
      Upload ({{ filesToUpload.length }})
    </button>
  </div>
</ng-template>

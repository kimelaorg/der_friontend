<div class="container py-4">
<div class="d-flex justify-content-between align-items-center mb-4">
<h2>ðŸ“¦ Inventory Management</h2>
<button class="btn btn-primary" (click)="openAddModal()">
<i class="bi bi-plus-circle"></i> Add New Item
</button>
</div>

<div class="table-responsive">
<table class="table table-striped table-hover align-middle">
<thead class="table-dark">
<tr>
<th>ID</th>
<th>Product</th> <th>Quantity in Stock</th>
<th>Safety Stock Level</th>
<th>Location</th> <th class="text-center">Actions</th>
</tr>
</thead>
<tbody>
<tr *ngFor="let item of inventory">
<td>{{ item.id }}</td>
<td>{{ item.product }}</td>
<td>{{ item.quantity_in_stock }}</td>
<td [class.text-danger]="item.quantity_in_stock < item.safety_stock_level">
{{ item.safety_stock_level }}
<i class="bi bi-exclamation-triangle-fill text-danger" *ngIf="item.quantity_in_stock < item.safety_stock_level"></i>
</td>
<td>{{ item.location }}</td>
<td class="text-center">
<button class="btn btn-sm btn-info me-2" (click)="openEditModal(item)">
<i class="bi bi-pencil-square"></i> Edit
</button>
<button class="btn btn-sm btn-danger" (click)="deleteItem(item.id)">
<i class="bi bi-trash"></i> Delete
</button>
</td>
</tr>
<tr *ngIf="inventory.length === 0">
<td colspan="6" class="text-center text-muted">No inventory items found. Click "Add New Item" to begin.</td>
</tr>
</tbody>
</table>
</div>
</div>

<ng-template #content let-modal>

<div class="modal-header bg-primary text-white">
<h4 class="modal-title" id="modal-basic-title">
{{ isEditing ? 'Edit Item (ID: ' + currentItem.id + ')' : 'Add New Item' }}
</h4>
<button
type="button"
class="btn-close"
aria-label="Close"
(click)="modal.dismiss('Cross click')"></button>
</div>

<form #inventoryForm="ngForm" (ngSubmit)="onSubmit(inventoryForm)">
<div class="modal-body">
<div class="row g-3">

    <div class="col-md-6">
      <label for="product" class="form-label">Product</label>
      <input
        type="text" class="form-control"
        id="product"
        name="product"
        [(ngModel)]="currentItem.product"
        required
        #productModel="ngModel"
        [ngbTypeahead]="searchProduct"
        [resultFormatter]="formatter"
        [inputFormatter]="inputFormatter"

        placeholder="Start typing product name..."
      >
      <div *ngIf="productModel.invalid && (productModel.dirty || productModel.touched)" class="text-danger">
        Product is required.
      </div>
    </div>

    <div class="col-md-6">
      <label for="location" class="form-label">Location</label>
      <input
        type="text" class="form-control"
        id="location"
        name="location"
        [(ngModel)]="currentItem.location"
        required
        #locationModel="ngModel"
        [ngbTypeahead]="searchLocation"
        [resultFormatter]="formatter"
        [inputFormatter]="inputFormatter"

        placeholder="Start typing location..."
      >
      <div *ngIf="locationModel.invalid && (locationModel.dirty || locationModel.touched)" class="text-danger">
        Location is required.
      </div>
    </div>

    <div class="col-md-6">
      <label for="quantity_in_stock" class="form-label">Quantity in Stock</label>
      <input
        type="number"
        class="form-control"
        id="quantity_in_stock"
        name="quantity_in_stock"
        [(ngModel)]="currentItem.quantity_in_stock"
        required
        min="0">
    </div>

    <div class="col-md-6">
      <label for="safety_stock_level" class="form-label">Safety Stock Level</label>
      <input
        type="number"
        class="form-control"
        id="safety_stock_level"
        name="safety_stock_level"
        [(ngModel)]="currentItem.safety_stock_level"
        required
        min="0">
    </div>
  </div>
</div>

<div class="modal-footer">
  <button
    type="button"
    class="btn btn-secondary"
    (click)="modal.dismiss('Cancel click')">
    Close
  </button>
  <button
    type="submit"
    class="btn btn-success"
    [disabled]="inventoryForm.invalid">
    <i class="bi bi-save"></i> {{ isEditing ? 'Update Item' : 'Add Item' }}
  </button>
</div>


</form>
</ng-template>
